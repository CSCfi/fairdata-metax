version: "3.8"

services:
  fairdata-nginx:
    image: nginx:latest
    configs:
      - source: fairdata-nginx
        target: /etc/nginx/nginx.conf
      - source: fairdata-ssl-certificate
        target: /etc/pki/tls/certs/ssl.crt.pem
      - source: fairdata-ssl-certificate-key
        target: /etc/pki/tls/private/ssl.key.pem
      - source: metax-nginx-elastic-headers-config
        target: '/etc/nginx/elastic_headers.conf'
      - source: metax-nginx-shared-headers-config
        target: '/etc/nginx/shared_headers.conf'
      - source: metax-nginx-api-response-headers-config
        target: '/etc/nginx/api_response_headers.conf'
      - source: metax-nginx-static-file-headers-config
        target: '/etc/nginx/static_file_headers.conf'
      - source: metax-nginx-dh-param-config
        target: '/etc/nginx/ssl_certs/nginx_dhparam.pem'
      - source: metax-nginx-config
        target: /etc/nginx/sites-enabled/metax
    ports:
      - 443:443

configs:
  metax-nginx-config:
    external: True
  fairdata-ssl-certificate:
    external: True
  fairdata-ssl-certificate-key:
    external: True
  fairdata-nginx:
    external: True
  metax-nginx-elastic-headers-config:
    external: True
  metax-nginx-shared-headers-config:
    external: True
  metax-nginx-api-response-headers-config:
    external: True
  metax-nginx-static-file-headers-config:
    external: True
  metax-nginx-dh-param-config:
    external: True