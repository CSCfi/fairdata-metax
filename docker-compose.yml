version: "3.3"

services:
  metax:
    image: fairdata-docker.artifactory.ci.csc.fi/fairdata-metax-web
    ports:
      - 8008:8008
      - 8000:8000
    volumes:
      - ./src:/code
    environment:
      DEBUG: 'true'
      METAX_DATABASE: 'metax_db_test'
      METAX_DATABASE_PASSWORD: 'YMDLekQMqrVKcs3'
      METAX_DATABASE_USER: 'metax_test'
      REDIS_HOST: redis
      RABBIT_MQ_HOSTS: rabbitmq
      ELASTIC_SEARCH_HOSTS: elasticsearch
      METAX_DATABASE_HOST: db
    configs:
      - source: metax-web-config
        target: '/code/metax_api/settings/.env'

  redis:
    image: redis
    volumes:
      - metax-redis:/data
  db:
    image: postgres:9
    environment:
      POSTGRES_USER: 'metax_test'
      POSTGRES_PASSWORD: 'YMDLekQMqrVKcs3'
      POSTGRES_DB: 'metax_db_test'
    volumes:
      - metax-postgres:/var/lib/postgresql96/data
  elasticsearch:
    image: elasticsearch:7.9.2
    environment:
      discovery.type: 'single-node'
    volumes:
      - metax-es:/usr/share/elasticsearch/data
  rabbitmq:
    image: rabbitmq:3-management
    volumes:
      - metax-rabbitmq:/var/lib/rabbitmq
configs:
  metax-web-config:
    external: True
volumes:
  metax-rabbitmq:
  metax-es:
  metax-postgres:
  metax-redis:



